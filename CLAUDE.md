# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Battery Monitor is a macOS battery monitoring system that collects metrics every 60 seconds via launchd, stores data in SQLite, and provides CLI tools plus a React-based dashboard for analysis.

## Commands

```bash
# Install/uninstall
./install.sh                    # Install daemon and CLI
./uninstall.sh                  # Remove everything

# CLI usage (after install)
battery                         # Current status
battery stats -d 7              # Stats from last 7 days
battery apps -d 14              # App impact analysis
battery sessions                # Discharge session history
battery history -H 48           # Last 48 hours of snapshots
battery health                  # Battery health analysis
battery export -o data.json     # Export to JSON

# Service control
launchctl stop com.battery-monitor.daemon
launchctl start com.battery-monitor.daemon

# Test data collection manually
python3 battery_collector.py    # Output current battery snapshot as JSON
python3 battery_daemon.py once  # Collect and store single snapshot
python3 battery_daemon.py start -f  # Run daemon in foreground
```

## Architecture

```
battery_collector.py   ─→ Gathers metrics using ioreg/pmset/top (no dependencies)
        ↓
battery_daemon.py      ─→ Background service, collects on interval, handles launchd signals
        ↓
battery_database.py    ─→ SQLite storage with schema: snapshots, active_apps,
                          power_assertions, discharge_sessions
        ↓
battery_cli.py         ─→ Terminal interface with ANSI colors for viewing data
dashboard.html         ─→ Standalone React+Recharts visualization (loads JSON exports)
```

**Data flow**: Daemon calls `collect_battery_snapshot()` → converts to dict → `BatteryDatabase.insert_snapshot()` stores core metrics + related app/assertion data → `update_discharge_session()` tracks drain cycles.

## Key Implementation Details

- Uses only Python 3 stdlib (no pip packages)
- macOS commands: `ioreg -rn AppleSmartBattery`, `pmset -g batt`, `pmset -g assertions`, `top -l 1`
- Database path: `~/.battery_monitor/battery.db`
- Install path: `~/.battery_monitor/`
- CLI command: `~/.local/bin/battery`
- launchd plist: `~/Library/LaunchAgents/com.battery-monitor.daemon.plist`

## Database Schema

- `snapshots`: Core metrics (percentage, wattage, temp, health, etc.)
- `active_apps`: Apps running during each snapshot (FK to snapshots)
- `power_assertions`: Apps preventing sleep (FK to snapshots)
- `discharge_sessions`: Tracks complete drain cycles with rates


<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>